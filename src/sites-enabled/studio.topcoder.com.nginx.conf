#||||||||||||||||||||||
# Server for STUDIO
#||||||||||||||||||||||
server {
	listen 8000;
	server_name studio.topcoder.com;
	root /home/apps/apache_docs/studiodocs;

	set $membersRedirect "";
	if ($args ~ module=ViewMemberProfile) {
		set $membersRedirect "${membersRedirect}G";
	}
	if ($args !~ legacy=true) {
		set $membersRedirect "${membersRedirect}O";
	}

	location / {
		if ($args ~ module=Login) {
			return 301 https://www.topcoder.com/login/?next=$http_x_forwarded_proto%3A%2F%2F$http_host$request_uri;
		}

		if ($membersRedirect = "GO") {
			return 301 $http_x_forwarded_proto://www.topcoder.com/members/$arg_ha;
		}

		client_max_body_size			200M;
		ajp_pass app_studio;
	}
	location /blog/studio {
		proxy_pass http://community.topcoder.com/studio;
		proxy_set_header Host community.topcoder.com;
	}
	location /i/m/ {
		alias /nfs_shares/member_photos/;
	}
	location /robots.txt {
		root /home/apps/apache_docs/studiodocs;
		autoindex off;
	}
	location /studio_sitemap.xml {
		root /home/apps/apache_docs/studiodocs;
		autoindex off;
	}
	# Google - Travis Haas
	location /google90d167ce3af43f71.html {
		root /home/apps/apache_docs/studiodocs;
		autoindex off;
	}
	# Google - Tony Jefts
	location /googlee24759091b086ad3.html {
		root /home/apps/apache_docs/studiodocs;
		autoindex off;
	}
	# Yahoo
	location /y_key_8c2ebf592be0ce98.html {
		root /home/apps/apache_docs/studiodocs;
		autoindex off;
	}
	location /favicon.ico {
		root /home/apps/apache_docs/studiodocs/i;
		autoindex off;
	}
	location /css/ {
		root /home/apps/apache_docs/studiodocs;
		autoindex off;
	}
	location /i/ {
		root /home/apps/apache_docs/studiodocs;
		autoindex off;
	}
	location /js/ {
		root /home/apps/apache_docs/studiodocs;
		autoindex off;
	}
	location /pdfs/ {
		root /home/apps/apache_docs/studiodocs;
		autoindex off;
	}
	location /html/ {
		root /home/apps/apache_docs/studiodocs;
		autoindex off;
	}
	location /web-console/ {
		root /home/apps/apache_docs/studiodocs;
		autoindex off;
	}
	location /jmx-console/ {
		root /home/apps/apache_docs/studiodocs;
		autoindex off;
	}
	location /crossdomain.xml {
		root /home/apps/apache_docs/studiodocs;
		autoindex off;
	}

	# redirect server error pages to the static page /50x.html
	error_page 500 502 503 504 /50x.html;
	location = /50x.html {
		root html;
	}
	location /studio_status {
		stub_status on;
		access_log off;
		allow 127.0.0.1;
		allow 54.172.147.189;
		allow 10.25.45.23;
		allow 10.25.45.216;
		deny all;
	}
}
