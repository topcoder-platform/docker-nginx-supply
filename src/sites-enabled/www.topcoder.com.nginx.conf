#||||||||||||||||||||||
# Server for WWW
#||||||||||||||||||||||
server {
	listen 8000;
	server_name www.topcoder.com;
	error_log logs/error.log error;
	access_log logs/access.log main;
	root /home/apps/apache_docs/tcdocs;
	set $no_cache 0;
	set $logged_in 0;
	set $legacy 0;

	if ($http_cookie ~* "tcjwt") {
		set $logged_in 1;
	}

	if ($http_cookie ~* "tcsso") { 
		set $logged_in_sso 1;
	}
	
	if ($args ~ module=MemberAchievementCurrent) {
		set $achievements 1;
	}
	
	if ($args ~ legacy=true) {
		set $legacy 1;
	}

	set $redirFlags "";
	if ($logged_in_sso = 0) {
		set $redirFlags "${redirFlags}0";
	}
	if ($args !~ nrg=false) {
		set $redirFlags "${redirFlags}2";
	}
	if ($args ~ nrg=false) {
		set $redirFlags "${redirFlags}3";
	}

	if ( $http_cookie ~* "comment_author_|wordpress_(?!test_cookie)|wp-postpass_" ) {
		set $no_cache 1;
	}

	if ($request_uri ~* "/(wp-admin/|wp-login.php)")
	{
		set $no_cache 1;
	}

	if ($http_user_agent ~* "facebookexternalhit")
	{
		set $no_cache 1;
	}
	# Force SSL if needed
	# See nginx.conf map for $www_preferred_proto for locations
	#
	if ($www_preferred_proto = "none") {
		set $www_preferred_proto $http_x_forwarded_proto;
	}
	# Redirect if the forwarded protocol doesnâ€™t match the preferred scheme
	if ($www_preferred_proto != $http_x_forwarded_proto) {
		return 301 $www_preferred_proto://www.topcoder.com$request_uri;
	}
	
	location /feed {
		add_header 'Access-Control-Allow-Origin' "$http_origin" always;
		add_header 'Access-Control-Allow-Headers' "Authorization,Content-Type,Accept,Origin,User-Agent,DNT,Cache-Control,X-Mx-ReqToken,Keep-Alive,X-Requested-With,If-Modified-Since" always;
		add_header 'Access-Control-Allow-Credentials' "true" always;
		include includes/mf01.nginx.conf;
	}

	location /blog {
		add_header 'Access-Control-Allow-Origin' "$http_origin" always;
		add_header 'Access-Control-Allow-Headers' "Authorization,Content-Type,Accept,Origin,User-Agent,DNT,Cache-Control,X-Mx-ReqToken,Keep-Alive,X-Requested-With,If-Modified-Since" always;
		add_header 'Access-Control-Allow-Credentials' "true" always;
		include includes/mf01.nginx.conf;
	}
	
	location /member-profile {
		if ($legacy = 0) {
			rewrite ^/member-profile/(.+)/.* https://www.topcoder.com/members/$1 last;
		}
		include includes/mf01.nginx.conf;
	}
	
	location /users {
		if ($legacy = 0) {
			rewrite ^/users/(.+)/.* https://www.topcoder.com/members/$1 last;
		}
		include includes/mf01.nginx.conf;
	}
	
	location /password-recovery {
		return 301 https://www.topcoder.com/reset-password;
	}
	
	location /password-reset {
		return 301 https://www.topcoder.com/reset-password;
	}
	
	location /login {
		try_files $uri @app;
	}

	location /register {
		try_files $uri @app;
	}

	location /logout {
		try_files $uri @app;
	}

	location /registered-successfully {
		try_files $uri @app;
	}

	location /reset-password {
		try_files $uri @app;
	}

	location /my-dashboard {
		try_files $uri @app;
	}
	
	location /my-challenges {
		try_files $uri @app;
	}
	
	location /my-srms {
		try_files $uri @app;
	}
	
	location /members {
		try_files $uri @app;
	}

	location /settings {
		try_files $uri @app;
	}

	location = /community {
		return 301 https://$host/community/members;
	}

	location /community/members {
		try_files $uri @app;
	}

	location /community/statistics {
		try_files $uri @app;
	}

	location /skill-picker {
		try_files $uri @app;
	}

	location /sitemap {
		try_files $uri @app;
	}

	location @app {
		if ( $real_scheme = 'http' ) {
			return 301 https://$host$request_uri;
		}
		include includes/app.nginx.conf;
		rewrite .* /app.topcoder.com/index.html break;
		proxy_pass https://s3.amazonaws.com;
	}

	location ~ ^/(styles|js)/(vendor||app) {
		try_files $uri @appassets;
	}

	# TODO reconcile images and fonts with below
	#location /images {
	# try_files $uri @appassets;
	#}
	#location /fonts {
	# try_files $uri @appassets;
	#}

	location @appassets {
		if ( $real_scheme = 'http' ) {
			return 301 https://$host$request_uri;
		}
		include includes/app.nginx.conf;
		rewrite (.*) /app.topcoder.com$1 break;
		proxy_pass https://s3.amazonaws.com;
	}
	
	include includes/prerender.nginx.conf;
	
	location = / {
		if ($logged_in = 1) {
			# if is not evil inside location to do return and rewrite...last
			return 302 https://www.topcoder.com/my-dashboard;
		}
		
		if ($http_x_forwarded_proto = 'http') {
			return 301 https://www.topcoder.com/;
		}
		
		include includes/mf01.nginx.conf;
	}
	location / {
		include includes/mf01.nginx.conf;
	}
	location /about_tc/ {
		root /home/apps/apache_docs/tcdocs;
		autoindex off;
	}
	location /admin/ {
		return 301 https://community.topcoder.com$request_uri;
	}
	location /admintool {
			# add trailing slash
		if ($request_uri = /admintool){
			return 301 https://$host/admintool/;
		}
		client_max_body_size			100M;
		ajp_pass app_direct;
	}
	location /ajaxdata/* {
		resolver dns01.topcoder.com valid=30s;
		set $apacheHost "apache.prod.topcoder.com";
		client_max_body_size			100M;
		proxy_set_header		Host $host;
		proxy_pass http://$apacheHost:8110$request_uri;
	}
	location /analytics {
			# add trailing slash
		if ($request_uri = /analytics){
			return 301 https://$host/analytics/;
		}
		client_max_body_size			100M;
		ajp_pass app_direct;
	}
	location /archive {
		resolver dns01.topcoder.com valid=30s;
		set $apacheHost "apache.prod.topcoder.com";
		client_max_body_size			100M;
		proxy_set_header		Host $host;
		proxy_pass http://$apacheHost:8110$request_uri;
	}
	location /asteroid {
		resolver dns01.topcoder.com valid=30s;
		set $apacheHost "apache.prod.topcoder.com";
		client_max_body_size			100M;
		proxy_set_header		Host $host;
		proxy_pass http://$apacheHost:8110$request_uri;
	}
	location /audio/ {
		root /home/apps/apache_docs/tcdocs;
		autoindex off;
	}
	location /aws {
		resolver dns01.topcoder.com valid=30s;
		set $apacheHost "apache.prod.topcoder.com";
		client_max_body_size			100M;
		proxy_set_header		Host $host;
		proxy_pass http://$apacheHost:8110$request_uri;
	}
	location /beta {
		resolver dns01.topcoder.com valid=30s;
		set $apacheHost "apache.prod.topcoder.com";
		client_max_body_size			100M;
		proxy_set_header		Host $host;
		proxy_pass http://$apacheHost:8110$request_uri;
	}
	location /btcu {
		resolver dns01.topcoder.com valid=30s;
		set $apacheHost "apache.prod.topcoder.com";
		client_max_body_size			100M;
		proxy_set_header		Host $host;
		proxy_pass http://$apacheHost:8110$request_uri;
	}
	location /bugs {
		return 301 https://apps.topcoder.com$request_uri;
	}
	location /cisco {
		return 301 http://cisco.topcoder.com;
	}
	location /cockpit2/ {
		root /home/apps/apache_docs/tcdocs;
		autoindex off;
	}
	location /contacts/ {
		root /home/apps/apache_docs/tcdocs;
		autoindex off;
	}
	location /contest/ {
		root /home/apps/apache_docs/tcdocs;
		autoindex off;
	}
	location /corp/ {
		client_max_body_size	100M;
		ajp_pass app_tc;
	}
	location /cms {
		resolver dns01.topcoder.com valid=30s;
		set $apacheHost "apache.prod.topcoder.com";
		client_max_body_size			100M;
		proxy_set_header		Host $host;
		proxy_pass http://$apacheHost:8110$request_uri;
	}
	location /collectiveminds {
		resolver dns01.topcoder.com valid=30s;
		set $apacheHost "apache.prod.topcoder.com";
		client_max_body_size			100M;
		proxy_set_header		Host $host;
		proxy_pass http://$apacheHost:8110$request_uri;
	}
	location /customer-roundtable {
		resolver dns01.topcoder.com valid=30s;
		set $apacheHost "apache.prod.topcoder.com";
		client_max_body_size			100M;
		proxy_set_header		Host $host;
		proxy_pass http://$apacheHost:8110$request_uri;
	}
	location ^~/css/ {
		root /home/apps/apache_docs/tcdocs;
		rewrite \/(.+)\.git(.+)\.(css)$ /$1.$3 break;
		autoindex off;
	}
	location /demo/ {
		root /home/apps/apache_docs/tcdocs;
		autoindex off;
	}
	location /direct/home.action {
		return 301 https://www.topcoder.com/login/?next=https%3A%2F%2F$http_host%2Fdirect%2F;
	}
	location /direct {
			# add trailing slash
		if ($request_uri = /direct){
			return 301 https://$host/direct/;
		}
		client_max_body_size			100M;
		ajp_pass app_direct;
	}
	location /docusign {
		resolver dns01.topcoder.com valid=30s;
		set $apacheHost "apache.prod.topcoder.com";
		client_max_body_size			100M;
		proxy_set_header		Host $host;
		proxy_pass http://$apacheHost:8110$request_uri;
	}
	location /doe {
		resolver dns01.topcoder.com valid=30s;
		set $apacheHost "apache.prod.topcoder.com";
		client_max_body_size			100M;
		proxy_set_header		Host $host;
		proxy_pass http://$apacheHost:8110$request_uri;
	}
	location /download/ {
		root /home/apps/apache_docs/tcdocs;
		autoindex off;
	}
	location /download-spec-page {
		resolver dns01.topcoder.com valid=30s;
		set $apacheHost "apache.prod.topcoder.com";
		client_max_body_size			100M;
		proxy_set_header		Host $host;
		proxy_pass http://$apacheHost:8110$request_uri;
	}
	location /dr {
		return 301 http://community.topcoder.com$request_uri;
	}
	location /dtn {
		resolver dns01.topcoder.com valid=30s;
		set $apacheHost "apache.prod.topcoder.com";
		client_max_body_size			100M;
		proxy_set_header		Host $host;
		proxy_pass http://$apacheHost:8110$request_uri;
	}
	location /earthscience {
		resolver dns01.topcoder.com valid=30s;
		set $apacheHost "apache.prod.topcoder.com";
		client_max_body_size			100M;
		proxy_set_header		Host $host;
		proxy_pass http://$apacheHost:8110$request_uri;
	}
	location /epa {
		resolver dns01.topcoder.com valid=30s;
		set $apacheHost "apache.prod.topcoder.com";
		client_max_body_size			100M;
		proxy_set_header		Host $host;
		proxy_pass http://$apacheHost:8110$request_uri;
	}
	location /es/climateresilience {
		return 301 http://www.topcoder.com/earthscience/crdc/;
	}
	location /event {
		resolver dns01.topcoder.com valid=30s;
		set $apacheHost "apache.prod.topcoder.com";
		client_max_body_size			100M;
		proxy_set_header		Host $host;
		proxy_pass http://$apacheHost:8110$request_uri;
	}
	location /flash/ {
		root /home/apps/apache_docs/tcdocs;
		autoindex off;
	}
	location /font/ {
		root /home/apps/apache_docs/tcdocs;
		autoindex off;
	}
	location /fonts/ {
		root /home/apps/apache_docs/tcdocs;
		autoindex off;
	}
	location /gov {
		resolver dns01.topcoder.com valid=30s;
		set $apacheHost "apache.prod.topcoder.com";
		client_max_body_size			100M;
		proxy_set_header		Host $host;
		proxy_pass http://$apacheHost:8110$request_uri;
	}
	location /home/alcatel {
		return 301 http://community.topcoder.com/alcatel;
	}
	location /home/amdapp {
		return 301 http://community.topcoder.com/ampadd;
	}
	location /home/csstem {
		return 301 http://community.topcoder.com/csstem;
	}
	location /home/darpacs {
		return 301 http://community.topcoder.com/darpacs;
	}
	location /home/help {
		return 301 http://help.topcoder.com/;
	}
	location /home/ntl {
		return 301 http://community.topcoder.com/ntl;
	}
	location /home/pfizerportal {
		return 301 http://community.topcoder.com/pfizerportal;
	}
	location /home/remixchallenge {
		return 301 http://community.topcoder.com/remixchallenge;
	}
	location /home/studio {
		return 301 http://community.topcoder.com/studio;
	}
	location /home/x {
		return 301 http://community.topcoder.com/x;
	}
	location /how-it-works {
		resolver dns01.topcoder.com valid=30s;
		set $apacheHost "apache.prod.topcoder.com";
		client_max_body_size			100M;
		proxy_set_header		Host $host;
		proxy_pass http://$apacheHost:8110$request_uri;
	}
	location /html/ {
		root /home/apps/apache_docs/tcdocs;
		autoindex off;
	}
	location /i/ {
		root /home/apps/apache_docs/tcdocs;
		autoindex off;
	}
	location /i/m/ {
		alias /nfs_shares/member_photos/;
	}
	location /images/ {
		root /home/apps/apache_docs/tcdocs;
		autoindex off;
	}
	location /images_old/ {
		root /home/apps/apache_docs/tcdocs;
		autoindex off;
	}
	location /includes/ {
		root /home/apps/apache_docs/tcdocs;
		autoindex off;
	}
	location /innovation-summit {
		resolver dns01.topcoder.com valid=30s;
		set $apacheHost "apache.prod.topcoder.com";
		client_max_body_size			100M;
		proxy_set_header		Host $host;
		proxy_pass http://$apacheHost:8110$request_uri;
	}
	location /iss {
		resolver dns01.topcoder.com valid=30s;
		set $apacheHost "apache.prod.topcoder.com";
		client_max_body_size			100M;
		proxy_set_header		Host $host;
		proxy_pass http://$apacheHost:8110$request_uri;
	}
	location /jive/ {
		root /home/apps/apache_docs/tcdocs;
		autoindex off;
	}
	location /js/ {
		root /home/apps/apache_docs/tcdocs;
		autoindex off;
	}
	location /kaboom {
		resolver dns01.topcoder.com valid=30s;
		set $apacheHost "apache.prod.topcoder.com";
		client_max_body_size			100M;
		proxy_set_header		Host $host;
		proxy_pass http://$apacheHost:8110$request_uri;
	}
	location /labs {
		resolver dns01.topcoder.com valid=30s;
		set $apacheHost "apache.prod.topcoder.com";
		client_max_body_size			100M;
		proxy_set_header		Host $host;
		proxy_pass http://$apacheHost:8110$request_uri;
	}
	location /longcontest {
		return 301 http://community.topcoder.com$request_uri;
	}
	location /movies/ {
		root /home/apps/apache_docs/tcdocs;
		autoindex off;
	}
	location /news_events/ {
		root /home/apps/apache_docs/tcdocs;
		autoindex off;
	}
	location /newsletter {
		return 301 http://www.topcoder.com/blog/;
	}
	location ^~ /PactsInternalServlet {
		return 301 http://community.topcoder.com$request_uri;
	}
	location ^~ /PactsMemberServlet {
		return 301 http://community.topcoder.com$request_uri;
	}
	location /pdfs/ {
		root /home/apps/apache_docs/tcdocs;
		autoindex off;
	}
	location ^~ /photo {
		return 301 http://community.topcoder.com$request_uri;
	}
	location /pl/ {
		return 301 http://community.topcoder.com$request_uri;
	}
	location /platform-updates {
		resolver dns01.topcoder.com valid=30s;
		set $apacheHost "apache.prod.topcoder.com";
		client_max_body_size			100M;
		proxy_set_header		Host $host;
		proxy_pass http://$apacheHost:8110$request_uri;
	}
	location /preview/ {
		root /home/apps/apache_docs/tcdocs;
		autoindex off;
	}
	location /products {
		resolver dns01.topcoder.com valid=30s;
		set $apacheHost "apache.prod.topcoder.com";
		client_max_body_size			100M;
		proxy_set_header		Host $host;
		proxy_pass http://$apacheHost:8110$request_uri;
	}
	location ^~ /query {
		return 301 http://community.topcoder.com$request_uri;
	}
	location /questionair {
		resolver dns01.topcoder.com valid=30s;
		set $apacheHost "apache.prod.topcoder.com";
		client_max_body_size			100M;
		proxy_set_header		Host $host;
		proxy_pass http://$apacheHost:8110$request_uri;
	}
	location ^~ /reg2 {
		return 301 https://www.topcoder.com/register/?next=$http_x_forwarded_proto%3A%2F%2F$http_host$request_uri;
	}
	location ^~ /reg {
		if ($redirFlags = "02") { # not logged in by sso, nrg = true or not present, go to register
			return 301 https://www.topcoder.com/register/?next=$http_x_forwarded_proto%3A%2F%2F$http_host$request_uri;
		}
		
		if ($redirFlags = "03") { # not logged in by sso, nrg = false, go to login
			return 301 https://www.topcoder.com/login/?next=$http_x_forwarded_proto%3A%2F%2F$http_host$request_uri;
		}
		
		return 301 https://www.topcoder.com/settings/account/;
	}
	location /registration/ {
		return 301 https://www.topcoder.com/register/?next=$http_x_forwarded_proto%3A%2F%2F$http_host$request_uri;
	}
	location /registration2/ {
		return 301 https://www.topcoder.com/register/?next=$http_x_forwarded_proto%3A%2F%2F$http_host$request_uri;
	}
	location /report {
		return 301 https://community.topcoder.com/tc?module=LegacyReport;
	}
	location /report_jsp/ {
		return 301 http://community.topcoder.com$request_uri;
	}
	location /reviews/ {
		root /home/apps/apache_docs/tcdocs;
		autoindex off;
	}
	location /roadshow {
		resolver dns01.topcoder.com valid=30s;
		set $apacheHost "apache.prod.topcoder.com";
		client_max_body_size			100M;
		proxy_set_header		Host $host;
		proxy_pass http://$apacheHost:8110$request_uri;
	}
	location /robots {
		return 301 http://robots.topcoder.com;
	}
	location /round_tables/ {
		root /home/apps/apache_docs/tcdocs;
		autoindex off;
	}
	location /schedule/ {
		root /home/apps/apache_docs/tcdocs;
		autoindex off;
	}
	location ^~/scripts/ {
		root /home/apps/apache_docs/tcdocs;
		rewrite \/(.+)\.git(.+)\.(js)$ /$1.$3 break;
		autoindex off;
	}
	location /smg {
		resolver dns01.topcoder.com valid=30s;
		set $apacheHost "apache.prod.topcoder.com";
		client_max_body_size			100M;
		proxy_set_header		Host $host;
		proxy_pass http://$apacheHost:8110$request_uri;
	}
	location /solarsystem {
		resolver dns01.topcoder.com valid=30s;
		set $apacheHost "apache.prod.topcoder.com";
		client_max_body_size			100M;
		proxy_set_header		Host $host;
		proxy_pass http://$apacheHost:8110$request_uri;
	}
	location /solutions/ {
		resolver dns01.topcoder.com valid=30s;
		set $apacheHost "apache.prod.topcoder.com";
		client_max_body_size			100M;
		proxy_set_header		Host $host;
		proxy_pass http://$apacheHost:8110$request_uri;
	}
	location /soy {
		resolver dns01.topcoder.com valid=30s;
		set $apacheHost "apache.prod.topcoder.com";
		client_max_body_size			100M;
		proxy_set_header		Host $host;
		proxy_pass http://$apacheHost:8110$request_uri;
	}
	location /sponsors-tco11 {
		resolver dns01.topcoder.com valid=30s;
		set $apacheHost "apache.prod.topcoder.com";
		client_max_body_size			100M;
		proxy_set_header		Host $host;
		proxy_pass http://$apacheHost:8110$request_uri;
	}
	location /stat {
		return 301 http://community.topcoder.com$request_uri;
	}
	location /static/ {
		root /home/apps/apache_docs/tcdocs;
		autoindex off;
	}
	location /statistics/ {
		root /home/apps/apache_docs/tcdocs;
		autoindex off;
	}
	location /sunshot {
		return 301 http://appirio.com/customer/crowdsourcing-projects/doe-sunshot/;
	}
	location /support/ {
		root /home/apps/apache_docs/tcdocs;
		autoindex off;
	}
	location /tc {
		if ($achievements = 0) {
			return 301 http://community.topcoder.com$request_uri;
		}

		if ($request_uri = "/tc") {
			set $redirectFlag tr;
		}

		if ($args = "") {
			set $redirectFlag "${redirectFlag}ue";
		}

		if ($redirectFlag = "true") {
			return 301 https://www.topcoder.com/;
		}

		client_max_body_size			100M;
		ajp_pass app_tc;
	}
	location /techchallenge {
		resolver dns01.topcoder.com valid=30s;
		set $apacheHost "apache.prod.topcoder.com";
		client_max_body_size			100M;
		proxy_set_header		Host $host;
		proxy_pass http://$apacheHost:8110$request_uri;
	}
	location /time {
		client_max_body_size			100M;
		ajp_pass app_tt;
	}

	location /video-wrapper {
		resolver dns01.topcoder.com valid=30s;
		set $apacheHost "apache.prod.topcoder.com";
		client_max_body_size			100M;
		proxy_set_header		Host $host;
		proxy_pass http://$apacheHost:8110$request_uri;
	}
	location /webinar {
		resolver dns01.topcoder.com valid=30s;
		set $apacheHost "apache.prod.topcoder.com";
		client_max_body_size			100M;
		proxy_set_header		Host $host;
		proxy_pass http://$apacheHost:8110$request_uri;
	}
	location /webiq/ {
		root /home/apps/apache_docs/tcdocs;
		autoindex off;
	}
	location /who-uses-topcoder {
		resolver dns01.topcoder.com valid=30s;
		set $apacheHost "apache.prod.topcoder.com";
		client_max_body_size			100M;
		proxy_set_header		Host $host;
		proxy_pass http://$apacheHost:8110$request_uri;
	}
	location /wiki {
		return 301 http://apps.topcoder.com$request_uri;
	}
	location /work/ {
		root /home/apps/apache_docs/tcdocs;
		autoindex off;
	}
	location /copilot/ {
		root /home/apps/apache_docs/tcdocs;
		autoindex off;
	}
	location /xml/ {
		root /home/apps/apache_docs/tcdocs;
		autoindex off;
	}
	location /xmlrpc.php {
		deny all;
	}
	location /robots.txt {
		root /home/apps/apache_docs/tcdocs;
		autoindex off;
	}
	location /\?s=* {
		resolver dns01.topcoder.com valid=30s;
		set $apacheHost "apache.prod.topcoder.com";
		client_max_body_size			100M;
		proxy_set_header		Host $host;
		proxy_pass http://$apacheHost:8110$request_uri;
	}
	location /\?mode=* {
		resolver dns01.topcoder.com valid=30s;
		set $apacheHost "apache.prod.topcoder.com";
		client_max_body_size			100M;
		proxy_set_header		Host $host;
		proxy_pass http://$apacheHost:8110$request_uri;
	}
	location /\?mkt_tok=* {
		resolver dns01.topcoder.com valid=30s;
		set $apacheHost "apache.prod.topcoder.com";
		client_max_body_size			100M;
		proxy_set_header		Host $host;
		proxy_pass http://$apacheHost:8110$request_uri;
	}
	# Proxy these requests to JBOSS Apache for checking individual nodes
	# Used by Pingdom and New Relic
	# TC Cache
	location /FRMRWQJ7F8tPlV0AjODCKxXuq1xq2mNo {
		resolver dns01.topcoder.com valid=30s;
		set $apacheHost "apache.prod.topcoder.com";
		proxy_set_header		Host $host;
		proxy_pass http://$apacheHost:8100/;
	}
	# TC Node 1
	location /qA0KG93JqIgDpdGzlUbpGzQSeD39L1rc {
		resolver dns01.topcoder.com valid=30s;
		set $apacheHost "apache.prod.topcoder.com";
		proxy_set_header		Host $host;
		proxy_pass http://$apacheHost:8100/;
	}
	# TC Node 2
	location /D1alRoF8InDnnZxGTJlBAMnvBrCX3ySn {
		resolver dns01.topcoder.com valid=30s;
		set $apacheHost "apache.prod.topcoder.com";
		proxy_set_header		Host $host;
		proxy_pass http://$apacheHost:8100/;
	}
	
	# redirect server error pages to the static page /50x.html
	error_page 500 502 503 504 /50x.html;
	location = /50x.html {
		root html;
	}
	location /www_topcoder_status {
		stub_status on;
		access_log off;
		allow 127.0.0.1;
		allow 54.172.147.189;
		deny all;
	}
}
