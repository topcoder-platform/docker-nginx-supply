#!/bin/bash
cd /mnt/nginx
chmod +x run
chmod +x build
id=`docker ps -q`
if [[ $id ]]; then
	echo "Stopping nginx server" >> /var/log/setup/setup.log
	docker stop $id
	echo "Removing nginx container" >> /var/log/setup/setup.log
	docker rm -v $(docker ps -a -q -f status=exited)
fi
echo "Starting new docker conatiner for nginx with new files" >> /var/log/setup/setup.log
docker build --no-cache -t nginx-supply:latest .
docker run -d -e "ENV=dev" -v /nfs_shares:/nfs_shares -v /mnt/nginx:/data/nginx -v /mnt/logs:/var/log/nginx/logs -p 8000:8000 nginx-supply:latest
